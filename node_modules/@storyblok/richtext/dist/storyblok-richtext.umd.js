/**
 * name: @storyblok/richtext
 * (c) 2024
 * description: Storyblok RichText Resolver
 * author: Alvaro Saburido <hola@alvarosaburido.dev> (https://github.com/alvarosabu/)
 */
(function(b,A){typeof exports=="object"&&typeof module<"u"?A(exports):typeof define=="function"&&define.amd?define(["exports"],A):(b=typeof globalThis<"u"?globalThis:b||self,A(b.StoryblokRichText={}))})(this,function(b){"use strict";function A(e,r){if(!r)return{src:e,attrs:{}};let a=0,E=0;const h={},l=[];function g(s,$,R,I,O){typeof s!="number"||s<=$||s>=R?console.warn(`[StoryblokRichText] - ${I.charAt(0).toUpperCase()+I.slice(1)} value must be a number between ${$} and ${R} (inclusive)`):O.push(`${I}(${s})`)}if(typeof r=="object"){if(typeof r.width=="number"&&r.width>0?(h.width=r.width,a=r.width):console.warn("[StoryblokRichText] - Width value must be a number greater than 0"),r.height&&typeof r.height=="number"&&r.height>0?(h.height=r.height,E=r.height):console.warn("[StoryblokRichText] - Height value must be a number greater than 0"),r.loading&&["lazy","eager"].includes(r.loading)&&(h.loading=r.loading),r.class&&(h.class=r.class),r.filters){const{filters:s}=r||{},{blur:$,brightness:R,fill:I,format:O,grayscale:m,quality:y,rotate:j}=s||{};$&&g($,0,100,"blur",l),y&&g(y,0,100,"quality",l),R&&g(R,0,100,"brightness",l),I&&l.push(`fill(${I})`),m&&l.push("grayscale()"),j&&[0,90,180,270].includes(r.filters.rotate||0)&&l.push(`rotate(${j})`),O&&["webp","png","jpeg"].includes(O)&&l.push(`format(${O})`)}r.srcset&&(h.srcset=r.srcset.map(s=>{if(typeof s=="number")return`${e}/m/${s}x0/${l.length>0?`filters:${l.join(":")}`:""} ${s}w`;if(Array.isArray(s)&&s.length===2){const[$,R]=s;return`${e}/m/${$}x${R}/${l.length>0?`filters:${l.join(":")}`:""} ${$}w`}else{console.warn("[StoryblokRichText] - srcset entry must be a number or a tuple of two numbers");return}}).join(", ")),r.sizes&&(h.sizes=r.sizes.join(", "))}let T=`${e}/m/`;return a>0&&E>0&&(T=`${T}${a}x${E}/`),l.length>0&&(T=`${T}filters:${l.join(":")}`),{src:T,attrs:h}}var c=(e=>(e.DOCUMENT="doc",e.HEADING="heading",e.PARAGRAPH="paragraph",e.QUOTE="blockquote",e.OL_LIST="ordered_list",e.UL_LIST="bullet_list",e.LIST_ITEM="list_item",e.CODE_BLOCK="code_block",e.HR="horizontal_rule",e.BR="hard_break",e.IMAGE="image",e.EMOJI="emoji",e.COMPONENT="blok",e))(c||{}),f=(e=>(e.BOLD="bold",e.STRONG="strong",e.STRIKE="strike",e.UNDERLINE="underline",e.ITALIC="italic",e.CODE="code",e.LINK="link",e.ANCHOR="anchor",e.STYLED="styled",e.SUPERSCRIPT="superscript",e.SUBSCRIPT="subscript",e.TEXT_STYLE="textStyle",e.HIGHLIGHT="highlight",e))(f||{}),_=(e=>(e.TEXT="text",e))(_||{}),C=(e=>(e.SELF="_self",e.BLANK="_blank",e))(C||{}),L=(e=>(e.URL="url",e.STORY="story",e.ASSET="asset",e.EMAIL="email",e))(L||{});const P=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"],k=(e={})=>Object.keys(e).map(r=>`${r}="${e[r]}"`).join(" "),U=(e={})=>Object.keys(e).map(r=>`${r}: ${e[r]}`).join("; ");function D(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}const p=e=>Object.fromEntries(Object.entries(e).filter(([r,a])=>a!==void 0));function x(e,r={},a){const E=k(r),h=E?`${e} ${E}`:e,l=Array.isArray(a)?a.join(""):a||"";if(e){if(P.includes(e))return`<${h}>`}else return l;return`<${h}>${l}</${e}>`}function G(e={}){let r=0;const{renderFn:a=x,textFn:E=D,resolvers:h={},optimizeImages:l=!1,keyedResolvers:g=!1}=e,T=a!==x,s=t=>i=>{const n=i.attrs||{};return g&&(n.key=`${t}-${r}`),a(t,n,i.children||null)},$=t=>{const{src:i,alt:n,title:o,srcset:S,sizes:u}=t.attrs||{};let d=i,v={};if(l){const{src:Y,attrs:q}=A(i,l);d=Y,v=q}g&&(v={...v,key:`img-${r}`});const F={src:d,alt:n,title:o,srcset:S,sizes:u,...v};return a("img",p(F))},R=t=>{const{level:i,...n}=t.attrs||{},o={...n};return g&&(o.key=`h${i}-${r}`),a(`h${i}`,o,t.children)},I=t=>{var o,S,u,d;const i=a("img",{src:(o=t.attrs)==null?void 0:o.fallbackImage,alt:(S=t.attrs)==null?void 0:S.alt,style:"width: 1.25em; height: 1.25em; vertical-align: text-top",draggable:"false",loading:"lazy"}),n={"data-type":"emoji","data-name":(u=t.attrs)==null?void 0:u.name,"data-emoji":(d=t.attrs)==null?void 0:d.emoji};return g&&(n.key=`emoji-${r}`),a("span",n,i)},O=t=>a("pre",{...t.attrs,key:`code-${r}`},a("code",{key:`code-${r}`},t.children||"")),m=(t,i=!1)=>({text:n,attrs:o})=>{const{class:S,id:u,...d}=o||{},v=i?{class:S,id:u,style:U(d)||void 0}:o||{};return g&&(v.key=`${t}-${r}`),a(t,p(v),n)},y=t=>w(t),j=t=>{const{marks:i,...n}=t;return"text"in t?i?i.reduce((o,S)=>y({...S,text:o}),y({...n,children:n.children})):E(n.text):""},H=t=>{const{linktype:i,href:n,anchor:o,...S}=t.attrs||{};let u="";switch(i){case L.ASSET:case L.URL:u=n;break;case L.EMAIL:u=`mailto:${n}`;break;case L.STORY:u=n,o&&(u=`${u}#${o}`);break;default:u=n;break}const d={...S};return u&&(d.href=u),g&&(d.key=`a-${r}`),a("a",d,t.text)},z=t=>{var i,n;return console.warn("[StoryblokRichtText] - BLOK resolver is not available for vanilla usage"),a("span",{blok:(i=t==null?void 0:t.attrs)==null?void 0:i.body[0],id:(n=t.attrs)==null?void 0:n.id,key:`component-${r}`,style:"display: none"})},K=new Map([[c.DOCUMENT,s("")],[c.HEADING,R],[c.PARAGRAPH,s("p")],[c.UL_LIST,s("ul")],[c.OL_LIST,s("ol")],[c.LIST_ITEM,s("li")],[c.IMAGE,$],[c.EMOJI,I],[c.CODE_BLOCK,O],[c.HR,s("hr")],[c.BR,s("br")],[c.QUOTE,s("blockquote")],[c.COMPONENT,z],[_.TEXT,j],[f.LINK,H],[f.ANCHOR,H],[f.STYLED,m("span",!0)],[f.BOLD,m("strong")],[f.TEXT_STYLE,m("span",!0)],[f.ITALIC,m("em")],[f.UNDERLINE,m("u")],[f.STRIKE,m("s")],[f.CODE,m("code")],[f.SUPERSCRIPT,m("sup")],[f.SUBSCRIPT,m("sub")],[f.HIGHLIGHT,m("mark")],...Object.entries(h).map(([t,i])=>[t,i])]);function N(t){r+=1;const i=K.get(t.type);if(!i)return console.error("<Storyblok>",`No resolver found for node type ${t.type}`),"";if(t.type==="text")return i(t);const n=t.content?t.content.map(w):void 0;return i({...t,children:n})}function w(t){return t.type==="doc"?T?t.content.map(N):t.content.map(N).join(""):Array.isArray(t)?t.map(N):N(t)}return{render:w}}b.BlockTypes=c,b.LinkTargets=C,b.LinkTypes=L,b.MarkTypes=f,b.TextTypes=_,b.richTextResolver=G,Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})});
