{"version":3,"file":"index.js","sources":["../src/CSS3DObject.ts","../src/CSS3DSprite.ts","../src/CSS3DRenderer.ts"],"sourcesContent":["import {Object3D} from 'three';\n\nexport class CSS3DObject extends Object3D {\n  public element: HTMLElement;\n\n  /**\n   * @param element Target Sprite DOM Element\n   */\n  constructor(element: HTMLElement) {\n    super();\n\n    this.element = element;\n    this.element.style.position = 'absolute';\n    this.element.style.pointerEvents = 'auto';\n\n    this.addEventListener('removed', () => {\n      this.traverse((object: Object3D) => {\n        if (\n          object instanceof CSS3DObject &&\n          object.element instanceof Element &&\n          object.element.parentNode !== null\n        ) {\n          object.element.parentNode.removeChild(object.element);\n        }\n      });\n    });\n  }\n\n  /**\n   * Copy content from another CSS3DObject.\n   * @param source Source CSS3DObject\n   * @param recursive\n   * @returns CSS3DObject\n   */\n  copy(source: CSS3DObject, recursive?: boolean) {\n    Object3D.prototype.copy.call(this, source, recursive);\n\n    this.element = source.element.cloneNode(true) as HTMLElement;\n\n    return this;\n  }\n}\n","import {Matrix4} from 'three';\nimport {CSS3DObject} from './CSS3DObject';\n\nexport class CSS3DSprite extends CSS3DObject {\n  public spriteRatio: number;\n  public spriteMatrixWorld: Matrix4;\n\n  /**\n   * @param element Target Sprite DOM Element\n   * @param spriteRatio The ratio for sprite rotation compensation, 1 for full sprite, 0 for normal 3D object.\n   */\n  constructor(element: HTMLElement, spriteRatio = 1) {\n    super(element);\n\n    this.spriteRatio = spriteRatio;\n    this.spriteMatrixWorld = new Matrix4().copy(this.matrixWorld);\n  }\n}\n","import {\n  Object3D,\n  EventDispatcher,\n  Matrix4,\n  Scene,\n  Camera,\n  OrthographicCamera,\n  Vector3,\n  Quaternion,\n} from 'three';\nimport {CSS3DObject} from './CSS3DObject';\nimport {CSS3DSprite} from './CSS3DSprite';\n\ninterface ObjectCache {\n  style: string;\n  distanceToCameraSquared?: number;\n}\n\nexport class CSS3DRenderer extends EventDispatcher {\n  /**\n   * Container element of CSS3D Scene.\n   */\n  public readonly domElement: HTMLElement;\n  /**\n   * Camera element of CSS3D transform.\n   */\n  public readonly cameraElement: HTMLElement;\n\n  private _width = 0;\n  private _height = 0;\n  private _widthHalf = 0;\n  private _heightHalf = 0;\n  private matrix = new Matrix4();\n  private _spriteQuat = new Quaternion();\n  private _objectQuat = new Quaternion();\n  private isIE: boolean;\n  private cache = {\n    camera: {fov: 0, style: ''},\n    objects: new WeakMap<CSS3DObject, ObjectCache>(),\n  };\n\n  private epsilon = (value: number) => (Math.abs(value) < 1e-10 ? 0 : value);\n\n  private getDistanceToSquared = (function () {\n    const a = new Vector3();\n    const b = new Vector3();\n\n    return function (object1: Object3D, object2: Object3D) {\n      a.setFromMatrixPosition(object1.matrixWorld);\n      b.setFromMatrixPosition(object2.matrixWorld);\n\n      return a.distanceToSquared(b);\n    };\n  })();\n\n  private zOrder(scene: Scene) {\n    const {cache} = this;\n\n    const items: {\n      object: CSS3DObject;\n      data: ObjectCache;\n    }[] = [];\n\n    scene.traverse(obj => {\n      const object = obj as CSS3DObject;\n      if (cache.objects.has(object)) {\n        items.push({\n          object,\n          data: cache.objects.get(object)!,\n        });\n      }\n    });\n\n    const order = items.sort(\n      (a, b) =>\n        // Only for IE, property is guaranteed to exist\n        a.data.distanceToCameraSquared! - b.data.distanceToCameraSquared!\n    );\n    const zMax = order.length;\n    order.forEach((info, index) => {\n      const {object} = info;\n\n      (object as CSS3DObject).element.style.zIndex = `${zMax - index}`;\n    });\n  }\n\n  private getCameraCSSMatrix = (\n    martrix: Matrix4,\n    camera: Camera,\n    fov: number\n  ) => {\n    const {epsilon} = this;\n    const {elements} = martrix;\n\n    // prettier-ignore\n    const matrixCSS = `matrix3d(${\n       epsilon(elements[0])},${\n       epsilon(- elements[1])},${\n       epsilon(elements[2])},${\n       epsilon(elements[3])},${\n       epsilon(elements[4])},${\n       epsilon(- elements[5])},${\n       epsilon(elements[6])},${\n       epsilon(elements[7])},${\n       epsilon(elements[8])},${\n       epsilon(- elements[9])},${\n       epsilon(elements[10])},${\n       epsilon(elements[11])},${\n       epsilon(elements[12])},${\n       epsilon(- elements[13])},${\n       epsilon(elements[14])},${\n       epsilon(elements[15])\n     })`;\n\n    if (camera instanceof OrthographicCamera) {\n      const tx = -(camera.right + camera.left) / 2;\n      const ty = (camera.top + camera.bottom) / 2;\n\n      return `scale(${fov})translate(${epsilon(tx)}px,${epsilon(\n        ty\n      )}px)${matrixCSS}`;\n    }\n\n    return `translateZ(${fov}px)${matrixCSS}`;\n  };\n\n  private getObjectCSSMatrix = (matrix: Matrix4, cameraCSSMatrix: string) => {\n    const {epsilon} = this;\n    const {elements} = matrix;\n\n    // prettier-ignore\n    const matrix3d = `matrix3d(${\n       epsilon(elements[0])},${\n       epsilon(elements[1])},${\n       epsilon(elements[2])},${\n       epsilon(elements[3])},${\n       epsilon(-elements[4])},${\n       epsilon(-elements[5])},${\n       epsilon(-elements[6])},${\n       epsilon(-elements[7])},${\n       epsilon(elements[8])},${\n       epsilon(elements[9])},${\n       epsilon(elements[10])},${\n       epsilon(elements[11])},${\n       epsilon(elements[12])},${\n       epsilon(elements[13])},${\n       epsilon(elements[14])},${\n       epsilon(elements[15])})`;\n\n    // prettier-ignore\n    if (this.isIE) {\n       return `translate(-50%,-50%)translate(${\n         this._widthHalf\n       }px,${\n         this._heightHalf\n       }px)${\n         cameraCSSMatrix\n       }${\n         matrix3d\n       }`;\n     }\n\n    return `translate(-50%,-50%)${matrix3d}`;\n  };\n\n  constructor() {\n    super();\n\n    const domElement = document.createElement('div');\n    this.domElement = domElement;\n    domElement.style.overflow = 'hidden';\n\n    const cameraElement = document.createElement('div');\n    this.cameraElement = cameraElement;\n    cameraElement.style.transformStyle = 'preserve-3d';\n\n    domElement.appendChild(cameraElement);\n\n    this.isIE = /Trident/i.test(navigator.userAgent);\n  }\n\n  setClearColor() {\n    /* noop */\n  }\n\n  /**\n   * Get the size of container element.\n   * @returns\n   */\n  getSize() {\n    return {\n      width: this._width,\n      height: this._height,\n    };\n  }\n\n  /**\n   * Set the size of container element.\n   * @param width The width of element\n   * @param height The height of element\n   */\n  setSize(width: number, height: number) {\n    this._width = width;\n    this._height = height;\n    this._widthHalf = this._width / 2;\n    this._heightHalf = this._height / 2;\n\n    this.domElement.style.width = `${width}px`;\n    this.domElement.style.height = `${height}px`;\n\n    this.cameraElement.style.width = `${width}px`;\n    this.cameraElement.style.height = `${height}px`;\n  }\n\n  renderObject = (\n    object: Object3D,\n    scene: Scene,\n    camera: Camera | OrthographicCamera,\n    cameraCSSMatrix: string\n  ) => {\n    const {\n      matrix,\n      getObjectCSSMatrix,\n      cache,\n      cameraElement,\n      renderObject,\n      isIE,\n      getDistanceToSquared,\n    } = this;\n    if (object instanceof CSS3DObject) {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      (object.onBeforeRender as any)(this, scene, camera);\n\n      let style;\n\n      if (object instanceof CSS3DSprite) {\n        // http://swiftcoder.wordpress.com/2008/11/25/constructing-a-billboard-matrix/\n\n        matrix.copy(camera.matrixWorldInverse);\n        // Get the inverse transforms\n        matrix.transpose();\n\n        // NOTE: The euler interp is probably cause Gimbal lock\n        // Convert the rotation part to euler to merge by ratio\n        // this._spriteEuler.setFromRotationMatrix(matrix); // camera inverse part\n        // this._objectEuler.setFromRotationMatrix(object.matrixWorld); // object rotation part\n\n        // this._spriteEuler.x = this._spriteEuler.x * object.spriteRatio + this._objectEuler.x * (1 - object.spriteRatio);\n        // this._spriteEuler.y = this._spriteEuler.y * object.spriteRatio + this._objectEuler.y * (1 - object.spriteRatio);\n        // this._spriteEuler.z = this._spriteEuler.z * object.spriteRatio + this._objectEuler.z * (1 - object.spriteRatio);\n        // matrix.makeRotationFromEuler(this._spriteEuler);\n\n        this._spriteQuat.setFromRotationMatrix(matrix);\n        this._objectQuat.setFromRotationMatrix(object.matrixWorld);\n        this._objectQuat.slerp(this._spriteQuat, object.spriteRatio);\n        matrix.makeRotationFromQuaternion(this._objectQuat);\n\n        matrix.copyPosition(object.matrixWorld);\n        matrix.scale(object.scale);\n\n        matrix.elements[3] = 0;\n        matrix.elements[7] = 0;\n        matrix.elements[11] = 0;\n        matrix.elements[15] = 1;\n\n        // save current computed sprite matrix\n        object.spriteMatrixWorld.copy(matrix);\n\n        style = getObjectCSSMatrix(matrix, cameraCSSMatrix);\n      } else {\n        style = getObjectCSSMatrix(object.matrixWorld, cameraCSSMatrix);\n      }\n\n      const {element} = object;\n      const cachedObject = cache.objects.get(object);\n\n      if (cachedObject === undefined || cachedObject.style !== style) {\n        element.style.transform = style;\n\n        const objectData: ObjectCache = {style};\n        cache.objects.set(object, objectData);\n\n        if (isIE) {\n          objectData.distanceToCameraSquared = getDistanceToSquared(\n            camera,\n            object\n          );\n        }\n      }\n\n      element.style.display = object.visible ? '' : 'none';\n\n      if (element.parentNode !== cameraElement) {\n        cameraElement.appendChild(element);\n      }\n\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      (object.onAfterRender as any)(this, scene, camera);\n    }\n\n    for (let i = 0, l = object.children.length; i < l; i++) {\n      renderObject(object.children[i], scene, camera, cameraCSSMatrix);\n    }\n  };\n\n  /**\n   * Update CSS3D scene.\n   * @param scene Three.js scene\n   * @param camera Three.js camera\n   */\n  render(scene: Scene, camera: Camera) {\n    const {\n      _heightHalf,\n      _widthHalf,\n      isIE,\n      cameraElement,\n      cache,\n      domElement,\n      getCameraCSSMatrix,\n      zOrder,\n      renderObject,\n    } = this;\n\n    const fov = camera.projectionMatrix.elements[5] * _heightHalf;\n\n    if (cache.camera.fov !== fov) {\n      domElement.style.perspective = `${fov}px`;\n\n      cache.camera.fov = fov;\n    }\n\n    // compatible for old version of three.js\n    if (\n      (scene.matrixAutoUpdate && scene.matrixAutoUpdate === true) ||\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      (scene as any).autoUpdate === true\n    ) {\n      scene.updateMatrixWorld();\n    }\n    if (camera.parent === null) camera.updateMatrixWorld();\n\n    const cameraCSSMatrix = getCameraCSSMatrix(\n      camera.matrixWorldInverse,\n      camera,\n      fov\n    );\n\n    const style = `${cameraCSSMatrix}translate(${_widthHalf}px,${_heightHalf}px)`;\n\n    if (cache.camera.style !== style && !isIE) {\n      cameraElement.style.transform = style;\n\n      cache.camera.style = style;\n    }\n\n    renderObject(scene, scene, camera, cameraCSSMatrix);\n\n    if (isIE) {\n      // IE10 and 11 does not support 'preserve-3d'.\n      // Thus, z-order in 3D will not work.\n      // We have to calc z-order manually and set CSS z-index for IE.\n      // FYI: z-index can't handle object intersection\n      zOrder(scene);\n    }\n  }\n}\n"],"names":["Object3D","Matrix4","EventDispatcher","Quaternion","Vector3","OrthographicCamera"],"mappings":"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"}